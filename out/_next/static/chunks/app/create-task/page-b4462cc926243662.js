(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8125],{95062:function(e,t,r){Promise.resolve().then(r.bind(r,89667))},89667:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return A}});var a=r(57437),s=r(2265),n=r(99376),i=r(4922),l=r(49365),o=r(99008),c=r(20847),u=r(19409),d=r(42228),h=r(95401),g=r(9182),f=r(65349),m=r(99394),v=r(49089),p=r(75265),k=r(33374),y=r(97717),x=r(29721),P=r(35069),S=r(88139);function j(e){let{task:t,setTask:r}=e,[n,i]=(0,s.useState)(t),{isOpen:l,onOpen:o,onOpenChange:c}=(0,p.q)(),u=()=>{n&&r(n)},d=()=>{i(t)};return(0,a.jsxs)("div",{className:"flex items-center justify-center gap-x-2 w-full",children:[(0,a.jsxs)("p",{className:"font-semibold md:text-3xl x-sm:text-lg 2sm:text-sm text-center",children:["Your Task:",(0,a.jsx)("span",{className:"underline ml-2 text-emerald-700",children:t})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(v.fmQ,{onClick:o,className:"text-emerald-900 text-xl cursor-pointer"}),(0,a.jsx)(k.R,{isOpen:l,onOpenChange:c,children:(0,a.jsx)(y.A,{children:e=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.k,{className:"flex flex-col gap-1",children:"Edit your Task's name here"}),(0,a.jsx)(P.I,{children:(0,a.jsx)("form",{action:"",onSubmit:e=>e.preventDefault(),children:(0,a.jsx)("input",{type:"text",placeholder:"Your task name goes here",value:n,onChange:e=>i(e.target.value),required:!0,maxLength:50,className:"focus:outline-none rounded-xl font-semibold py-4 px-4 border-emerald-700 border-1 w-full"})})}),(0,a.jsxs)(S.R,{children:[(0,a.jsx)(m.A,{color:"danger",variant:"light",onPress:e,onClick:d,children:"Close"}),(0,a.jsx)(m.A,{onPress:e,onClick:u,children:"Save"})]})]})})})]})]})}var w=r(41258),Z=r(21949),T=r(46175);let b=new(r(86116)).E;function D(){var e;let t=(0,n.useRouter)(),r=(0,n.useSearchParams)(),[v,p]=(0,s.useState)(null!==(e=r.get("task"))&&void 0!==e?e:""),[k,y]=(0,s.useState)([]),[x,P]=(0,s.useState)([]),[S,D]=(0,s.useState)(0),[C,A]=(0,s.useState)(""),[N,R]=(0,s.useState)(""),[I,E]=(0,s.useState)(void 0),[_,O]=(0,s.useState)(void 0),[z,L]=(0,s.useState)(""),[q,K]=(0,s.useState)(""),[Y,U]=(0,s.useState)(""),[B,F]=(0,s.useState)(!1),[G,J]=(0,s.useState)(""),[M,H]=(0,s.useState)([]),[W,Q]=(0,s.useState)(0),V=async()=>{H(await w.m.getAllSkills())};(0,s.useEffect)(()=>{V(),X()},[]);let X=()=>{y(b.getAllDistricts())},$=e=>{Q(parseInt(e,10))},ee=e=>{D(parseInt(e,10)),F(!0);try{let t=b.getWardsInDistrict(parseInt(e,10));P(t)}catch(e){J("Failed to fetch wards"),console.error(e)}finally{F(!1)}},et=e=>{A(e)},er=e=>{let t=new Date;return t.setHours(0,0,0,0),new Date(e)>=t},ea=(e,t)=>{let r=new Date(e);return r.setHours(0,0,0,0),new Date(t)>=r},es=e=>{let t=e.trim();for(let e=0;e<t.length;e++){let r=t.charCodeAt(e);if(r<48||r>57)return!1}return Number(t)>0},en=e=>{let t=e.trim();for(let e=0;e<t.length;e++){let r=t.charCodeAt(e);if(r<48||r>57)return!1}return Number(t)>0},ei=async e=>{let r,a,s,n;if(e.preventDefault(),!N){T.ZP.error("Please provide a detailed address.",{duration:2e3});return}if(!I){T.ZP.error("Please select a start date.",{duration:2e3});return}if(!er(I.toString())){T.ZP.error("Start date cannot be in the past.",{duration:2e3});return}if(!_){T.ZP.error("Please select an end date.",{duration:2e3});return}if(!ea(I.toString(),_.toString())){T.ZP.error("End date cannot be in the past of the Start date.",{duration:2e3});return}if(!es(z)){T.ZP.error("Please provide a valid estimated duration.",{duration:2e3});return}if(!en(q)){T.ZP.error("Please provide a valid expected rate.",{duration:2e3});return}if(!Y){T.ZP.error("Please provide a task description.",{duration:2e3});return}let i=null==I?void 0:I.year,l=null==_?void 0:_.year;r=(null==I?void 0:I.day)&&(null==I?void 0:I.day)<10?"0".concat(null==I?void 0:I.day):"".concat(null==I?void 0:I.day),s=(null==_?void 0:_.day)&&(null==_?void 0:_.day)<10?"0".concat(null==_?void 0:_.day):"".concat(null==_?void 0:_.day),a=(null==I?void 0:I.month)&&(null==I?void 0:I.month)<10?"0".concat(null==I?void 0:I.month):"".concat(null==I?void 0:I.month),n=(null==_?void 0:_.month)&&(null==_?void 0:_.month)<10?"0".concat(null==_?void 0:_.month):"".concat(null==_?void 0:_.month);let o="".concat(i,"-").concat(a,"-").concat(r),c="".concat(l,"-").concat(n,"-").concat(s),u={title:v,description:Y,skill_id:W,district:S,ward:C,detail_address:N,estimated_duration:parseInt(z,10),fee_per_hour:q,start_date:o,end_date:c};console.log(await Z.O.create(u)),t.push("/taskmanage")};return(0,a.jsxs)("div",{className:"my-10",children:[(0,a.jsx)("p",{className:"font-bold text-center text-emerald-900 x-sm:text-lg 2sm:text-sm md:text-3xl",children:"Provide us with more details of your task here"}),(0,a.jsx)("div",{children:(0,a.jsx)("form",{onSubmit:ei,children:(0,a.jsxs)(i.w,{className:"m-auto mt-6 px-10 py-4 w-10/12",children:[(0,a.jsx)(l.u,{children:(0,a.jsx)(j,{task:v,setTask:p})}),(0,a.jsxs)(o.G,{className:"flex flex-col gap-y-7 mt-5",children:[(0,a.jsx)("div",{children:(0,a.jsx)(c.g,{labelPlacement:"outside",label:"Select your Skill for this Task",placeholder:"Choose Skill",isRequired:!0,variant:"faded",isLoading:B,onChange:e=>$(e.target.value),children:M.map(e=>(0,a.jsx)(u.R,{value:e.id,children:e.name},e.id))})}),(0,a.jsx)("div",{children:(0,a.jsx)(c.g,{labelPlacement:"outside",label:"Select your district",placeholder:"Choose district",isRequired:!0,variant:"faded",isLoading:B,onChange:e=>ee(e.target.value),children:k.map(e=>(0,a.jsx)(u.R,{value:e.code,children:e.name},e.code))})}),(0,a.jsx)("div",{children:(0,a.jsx)(c.g,{labelPlacement:"outside",label:"Select your ward",placeholder:"Choose ward",isRequired:!0,variant:"faded",isLoading:B,isDisabled:!S,onChange:e=>et(e.target.value),children:x.map(e=>(0,a.jsx)(u.R,{value:e.code,children:e.name},e.code))})}),G&&(0,a.jsx)("p",{className:"text-red-500",children:G}),(0,a.jsx)("div",{children:(0,a.jsx)(d.Y,{type:"text",label:"Detailed Address ",placeholder:"Your specific address.",labelPlacement:"outside",isRequired:!0,size:"md",variant:"faded",onChange:e=>R(e.target.value)})}),(0,a.jsx)("div",{children:(0,a.jsx)(h.N,{label:"Start Date",labelPlacement:"outside",isRequired:!0,size:"md",variant:"faded",value:I,onChange:e=>{E(e)}})}),(0,a.jsx)("div",{children:(0,a.jsx)(h.N,{label:"End Date",labelPlacement:"outside",isRequired:!0,size:"md",variant:"faded",value:_,onChange:e=>{O(e)}})}),(0,a.jsx)("div",{children:(0,a.jsx)(d.Y,{type:"text",label:"Estimated Duration ",placeholder:"Estimated total hours needed to complete this task.",labelPlacement:"outside",isRequired:!0,size:"md",variant:"faded",onChange:e=>L(e.target.value)})}),(0,a.jsx)("div",{children:(0,a.jsx)(d.Y,{type:"text",label:"Expected Rate",placeholder:"How much can you pay for this task per hour?",labelPlacement:"outside",isRequired:!0,size:"md",variant:"faded",onChange:e=>K(e.target.value)})}),(0,a.jsx)("div",{children:(0,a.jsx)(g.Y,{type:"text",label:"Task Description",placeholder:"Give taskers more details about the task!",labelPlacement:"outside",isRequired:!0,size:"md",variant:"faded",onChange:e=>U(e.target.value)})})]}),(0,a.jsxs)(f.i,{className:"flex flex-col items-end gap-y-4 mt-5",children:[(0,a.jsx)(m.A,{className:"w-full",color:"success",type:"submit",children:"POST YOUR TASK"}),(0,a.jsx)("p",{onClick:()=>t.push("/services"),className:"text-green-500 x-sm:text-xs 2sm:text-[8px] md:text-base underline cursor-pointer",children:"Looking for more services? Goes here."})]})]})})})]})}var C=r(61915);function A(){return(0,a.jsx)(s.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsx)(C.ProtectedRoute,{children:(0,a.jsx)(D,{})})})}},47043:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});var a=r(57437),s=r(1377);function n(){return(0,a.jsx)("div",{className:"fixed inset-0 bg-white flex items-center justify-center z-50",children:(0,a.jsx)(s.c,{size:"lg",color:"success",label:"Loading..."})})}},61915:function(e,t,r){"use strict";r.d(t,{ProtectedRoute:function(){return o}});var a=r(57437),s=r(50835),n=r(99376),i=r(2265),l=r(47043);function o(e){let{children:t}=e,{isAuthenticated:r,user:o}=(0,s.CG)(e=>e.auth),c=(0,n.useRouter)(),u=(0,n.usePathname)(),d=["/admin","/admin/users","/admin/tasks","/admin/monitor"],{isTasker:h}=(0,s.CG)(e=>e.auth);return((0,i.useEffect)(()=>{if(r){let e=window.location.pathname;!h&&["/tasks","/taskmanage"].includes(e)&&c.replace("/becometasker")}else c.replace("/login");if(d.some(e=>u.startsWith(e))&&(null==o?void 0:o.role)!=="ADMIN"){c.replace("/");return}if((null==o?void 0:o.role)==="ADMIN"&&"/"===u){c.replace("/admin");return}},[r,o,u,c]),!r||d.some(e=>u.startsWith(e))&&(null==o?void 0:o.role)!=="ADMIN")?(0,a.jsx)(l.Z,{}):t}},11002:function(e,t,r){"use strict";r.d(t,{Dj:function(){return s},UR:function(){return l},YA:function(){return o},kS:function(){return n},uJ:function(){return i}});let a=(0,r(1455).oM)({name:"auth",initialState:{user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isTasker:!1},reducers:{setCredentials:(e,t)=>{let{user:r,token:a}=t.payload;e.user=r,e.accessToken=a.access_token,e.refreshToken=a.refresh_token,e.isAuthenticated=!0,r.tasker&&(e.isTasker=!0),localStorage.setItem("user",JSON.stringify(r)),localStorage.setItem("isTasker",e.isTasker.toString()),localStorage.setItem("accessToken",a.access_token),localStorage.setItem("refreshToken",a.refresh_token)},setisTaskers:(e,t)=>{e.isTasker=t.payload,localStorage.setItem("isTasker","true")},logout:e=>{e.user=null,e.accessToken=null,e.refreshToken=null,e.isTasker=!1,e.isAuthenticated=!1,localStorage.removeItem("user"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("isTasker")},loginFailure:e=>{console.log("Login failed"),e.isAuthenticated=!1},initializeAuth:e=>{try{let t=localStorage.getItem("user"),r=localStorage.getItem("accessToken"),a=localStorage.getItem("refreshToken"),s=localStorage.getItem("isTasker");t&&r&&a?(e.user=JSON.parse(t),e.accessToken=r,e.refreshToken=a,e.isAuthenticated=!0):e.isAuthenticated=!1,(null==s?void 0:s.toString())==="true"&&(e.isTasker="true"===s)}catch(t){console.error("Error initializing auth from localStorage:",t),e.isAuthenticated=!1}}}}),{setCredentials:s,logout:n,initializeAuth:i,loginFailure:l,setisTaskers:o}=a.actions;t.ZP=a.reducer},50835:function(e,t,r){"use strict";r.d(t,{CG:function(){return o},TL:function(){return l},h:function(){return i}});var a=r(1455),s=r(68575),n=r(11002);let i=(0,a.xC)({reducer:{auth:n.ZP},middleware:e=>e({serializableCheck:!1})}),l=s.I0,o=s.v9},82479:function(e,t,r){"use strict";r.d(t,{O:function(){return c}});var a=r(11002),s=r(50835),n=r(83464),i=r(42321),l=r(46175);class o{async register(e){try{let t=await i.Z.post("/auth/register",JSON.stringify(e));return l.ZP.success("Đăng k\xfd th\xe0nh c\xf4ng"),t.data}catch(e){throw l.ZP.error("Đăng k\xfd thất bại"),console.log(e),e}}async login(e){try{console.log("http://localhost:5000/api/auth/login");let t=await i.Z.post("/auth/login",JSON.stringify(e)),r=t.data;return s.h.dispatch((0,a.Dj)(r)),l.ZP.success("Đăng nhập th\xe0nh c\xf4ng"),t.data}catch(t){throw console.log(t),l.ZP.error("Đăng nhập thất bại"),this.handleAuthError(e),t}}async refreshToken(){if(this.refreshPromise)return this.refreshPromise;let e=this.getRefreshToken();if(!e)throw Error("No refresh token available");return this.refreshPromise=i.Z.post("/auth/refresh",{refreshToken:e}).then(e=>{let{access_token:t,refresh_token:r}=e.data;return s.h.dispatch((0,a.Dj)({user:s.h.getState().auth.user,token:{access_token:t,refresh_token:r}})),e.data}).catch(e=>{throw this.logout(),e}).finally(()=>{this.refreshPromise=null}),this.refreshPromise}async logout(){s.h.dispatch((0,a.kS)())}handleAuthError(e){if(n.Z.isAxiosError(e)){var t,r;let n=(null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"Authentication failed";s.h.dispatch((0,a.UR)(n))}else s.h.dispatch((0,a.UR)())}getAccessToken(){return s.h.getState().auth.accessToken}getRefreshToken(){return s.h.getState().auth.refreshToken}isTokenExpired(e){if(!e)return!0;try{let t=e.split(".");if(3!==t.length)return!0;let r=JSON.parse(atob(t[1]));return Date.now()>=1e3*r.exp-3e4}catch(e){return!0}}constructor(){this.refreshPromise=null}}let c=new o},42321:function(e,t,r){"use strict";var a=r(83464),s=r(82479);let n=a.Z.create({baseURL:"http://localhost:5000/api",headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:1e4});n.interceptors.request.use(async e=>{var t,r,a;let n=s.O.getAccessToken();if((null===(t=e.url)||void 0===t?void 0:t.includes("/auth/login"))||(null===(r=e.url)||void 0===r?void 0:r.includes("/auth/refresh"))||(null===(a=e.url)||void 0===a?void 0:a.includes("/auth/register")))return console.log(e),e;try{if(!n)throw Error("No access token available");if(s.O.isTokenExpired(n)){let t=await s.O.refreshToken();e.headers.Authorization="Bearer ".concat(t.access_token)}else e.headers.Authorization="Bearer ".concat(n)}catch(e){s.O.logout(),console.log(e)}return e},e=>Promise.reject(e)),n.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;if(!r||r._retry)return Promise.reject(e);if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&r.url&&!r.url.includes("/auth/login")&&!r.url.includes("/auth/refresh"))try{r._retry=!0;let e=await s.O.refreshToken();return r.headers&&(r.headers.Authorization="Bearer ".concat(e.access_token)),n(r)}catch(e){return s.O.logout(),Promise.reject(e)}return Promise.reject(e)}),t.Z=n},86116:function(e,t,r){"use strict";r.d(t,{E:function(){return s}});var a=r(46175);class s{async loadCityData(){try{let e=await fetch("".concat(this.hostURL,"location.json"));this.cityData=await e.json()}catch(e){throw a.ZP.error("Lỗi khi tải dữ liệu th\xe0nh phố:"),e}}getAllDistricts(){return this.cityData?this.cityData.districts:(console.error("Dữ liệu th\xe0nh phố chưa được tải."),[])}getDistrictByCode(e){return this.cityData?this.cityData.districts.find(t=>t.code===e)||null:(console.error("Dữ liệu th\xe0nh phố chưa được tải."),null)}getWardByCode(e){if(!this.cityData)return console.error("Dữ liệu th\xe0nh phố chưa được tải."),null;for(let t of this.cityData.districts){let r=t.wards.find(t=>t.code===e);if(r)return r}return null}getWardsInDistrict(e){if(!this.cityData)return console.error("Dữ liệu th\xe0nh phố chưa được tải."),[];let t=this.getDistrictByCode(e);return t?t.wards:[]}constructor(){this.hostURL="http://localhost:3000/",this.cityData=null,this.loadCityData()}}},41258:function(e,t,r){"use strict";r.d(t,{m:function(){return n}});var a=r(42321),s=r(46175);let n={async addSkill(e){try{let t=await a.Z.post("/skills",e);return s.ZP.success("Skill added successfully"),t.data}catch(e){throw s.ZP.error("Failed to add skill"),e}},async getAllSkills(){try{return(await a.Z.get("/skills")).data}catch(e){throw s.ZP.error("Failed to fetch skills"),e}},async deleteSkill(e){try{let t=await a.Z.delete("/skills/".concat(e.id));return s.ZP.success("Skill deleted successfully"),t.data}catch(e){throw s.ZP.error("Failed to delete skill"),e}},async updateSkill(e){try{let t=await a.Z.patch("/skills/".concat(e.id),e);return s.ZP.success("Skill updated successfully"),t.data}catch(e){throw s.ZP.error("Failed to update skill"),e}}}},21949:function(e,t,r){"use strict";r.d(t,{O:function(){return n}});var a=r(46175),s=r(42321);let n={async create(e){try{let t=await s.Z.post("/tasks",e);return a.ZP.success("Tạo c\xf4ng việc th\xe0nh c\xf4ng"),t.data}catch(e){throw a.ZP.error("Kh\xf4ng thể tạo c\xf4ng việc n\xe0y"),e}},async getMe(){try{return(await s.Z.get("/tasks/admin")).data}catch(e){throw a.ZP.error("Kh\xf4ng thể lấy th\xf4ng tin c\xf4ng việc"),e}},async deleteMe(e){try{let t=await s.Z.delete("/tasks/".concat(e.id));return a.ZP.success("Hủy c\xf4ng việc th\xe0nh c\xf4ng"),t.data}catch(e){throw a.ZP.error("Kh\xf4ng thể hủy c\xf4ng việc n\xe0y"),e}},async getAllTasksCreatedByUser(){try{return(await s.Z.get("/tasks/user")).data}catch(e){throw a.ZP.error("Kh\xf4ng thể lấy th\xf4ng tin c\xf4ng việc"),e}},async userChooseTasker(e,t){try{await s.Z.patch("/tasks/".concat(e,"/choose/").concat(t)),a.ZP.success("Chọn Người l\xe0m việc th\xe0nh c\xf4ng")}catch(e){throw a.ZP.error("Kh\xf4ng thể chọn người l\xe0m n\xe0y! H\xe3y thử lại sau"),e}},async applyTask(e){try{let t=await s.Z.patch("/tasks/".concat(e,"/apply"));return a.ZP.success("Ứng tuyển c\xf4ng việc th\xe0nh c\xf4ng!"),console.log(t.data),t.data}catch(e){throw a.ZP.error("Kh\xf4ng thể ứng tuyển c\xf4ng việc n\xe0y"),e}},async acceptTask(e){try{let t=await s.Z.patch("/tasks/".concat(e,"/accept"));return a.ZP.success("Ứng tuyển c\xf4ng việc th\xe0nh c\xf4ng!"),console.log(t.data),t.data}catch(e){throw a.ZP.error("Kh\xf4ng thể ứng tuyển c\xf4ng việc n\xe0y"),e}},async getTaskerTasks(){try{let e=await s.Z.get("/tasks/tasker");return console.log(e.data),e.data}catch(e){throw a.ZP.error("Kh\xf4ng thể lấy th\xf4ng tin c\xf4ng việc"),e}}}}},function(e){e.O(0,[7699,707,7405,4218,8187,2952,1554,8083,6175,3464,9897,9863,4721,4958,9136,3522,6386,2971,2117,1744],function(){return e(e.s=95062)}),_N_E=e.O()}]);