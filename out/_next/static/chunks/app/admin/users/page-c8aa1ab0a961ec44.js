(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9674],{53355:function(e,t,s){Promise.resolve().then(s.bind(s,68138))},68138:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return L}});var r=s(57437),i=s(2265),n=s(84409),a=s(16454),l=s(75265),c=s(4922),o=s(99008),h=s(34778),d=s(99394),u=s(33374),x=s(97717),g=s(29721),m=s(35069),f=s(88139),p=s(49961),j=s(64264),k=s(99141),v=s(17032),y=s(65349),N=s(89345),w=s(13041),T=s(88501),Z=s(83774),S=s(71533),A=s(15868),P=s(42208),_=s(94766),C=s(95468),E=s(27413),I=e=>{let{users:t,onView:s,onModify:I,onBlock:b,onHistory:z,onDelete:D,onNotify:O}=e,[R,M]=(0,i.useState)(""),[W,L]=(0,i.useState)(!0);(0,i.useEffect)(()=>{let e=async e=>{try{var t;if(null===(t=e.tasker)||void 0===t?void 0:t.work_area){let t=await a.E.getDistrict(e.tasker.work_area);M(t)}}catch(e){console.error("Error fetching district names:",e),M("Error loading districts")}finally{L(!1)}};t.forEach(t=>e(t))},[t]);let{isOpen:U,onOpen:B,onClose:J}=(0,l.q)();return(0,r.jsx)(r.Fragment,{children:t.map(e=>{var t;return(0,r.jsxs)(c.w,{className:"w-full",children:[(0,r.jsx)(o.G,{children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsx)(n.z,{name:e.profile.first_name+" "+e.profile.last_name,description:e.email,avatarProps:(0,r.jsx)(h.h,{name:e.profile.first_name+" "+e.profile.last_name})}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(d.A,{onPress:B,variant:"light",onClick:()=>s(e.id),className:"flex",children:"View Details"}),(0,r.jsx)(u.R,{isOpen:U,onClose:J,size:"2xl",children:(0,r.jsxs)(x.A,{children:[(0,r.jsx)(g.k,{className:"flex flex-col gap-1",children:"User Details"}),(0,r.jsx)(m.I,{children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(h.h,{className:"w-20 h-20",showFallback:!0,name:e.profile.first_name+" "+e.profile.last_name}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm text-gray-500",children:"Name"}),(0,r.jsx)("p",{className:"text-lg font-semibold",children:e.profile.first_name+" "+e.profile.last_name})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm text-gray-500",children:"Email"}),(0,r.jsxs)("p",{className:"flex items-center gap-2",children:[(0,r.jsx)(N.Z,{size:16}),e.email]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm text-gray-500",children:"Phone"}),(0,r.jsxs)("p",{className:"flex items-center gap-2",children:[(0,r.jsx)(w.Z,{size:16}),e.profile.phone_number]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm text-gray-500",children:"Gender"}),(0,r.jsx)("p",{className:"flex items-center gap-2",children:e.profile.gender})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm text-gray-500",children:"Date_of_Birth"}),(0,r.jsxs)("p",{className:"flex items-center gap-2",children:[(0,r.jsx)(T.Z,{size:16}),e.profile.birth_date]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm text-gray-500",children:"Work Area"}),e.tasker?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("p",{className:"flex items-center gap-2",children:[(0,r.jsx)(Z.Z,{size:16}),W?"Loading districts...":R||"No area specified"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm text-gray-500",children:"Skills"}),e.tasker.skills&&e.tasker.skills.length>0?(0,r.jsx)("ul",{className:"list-disc list-inside",children:e.tasker.skills.map((e,t)=>(0,r.jsx)("li",{className:"text-sm",children:e.name},t))}):(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"No skills listed"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-gray-500",children:"Experience"}),(0,r.jsx)("p",{children:e.tasker.experience||"N/A"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-gray-500",children:"Tasks Completed"}),(0,r.jsx)("p",{children:e.tasker.completed_tasks||0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-gray-500",children:"Rating"}),(0,r.jsx)("p",{children:(null===(t=e.tasker.avg_rating)||void 0===t?void 0:t.toFixed(1))||"No ratings"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-gray-500",children:"Rating Count"}),(0,r.jsx)("p",{children:e.tasker.rating_count||0})]})]})]}):(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"Not a tasker"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm text-gray-500",children:"Description"}),(0,r.jsx)("p",{children:e.profile.description})]})]})}),(0,r.jsx)(f.R,{children:(0,r.jsx)(d.A,{color:"primary",variant:"solid",onPress:J,children:"I got it"})})]})}),(0,r.jsxs)(p.F,{children:[(0,r.jsx)(j.S,{children:(0,r.jsx)(d.A,{isIconOnly:!0,variant:"light",children:(0,r.jsx)(S.Z,{size:20})})}),(0,r.jsxs)(k.a,{children:[(0,r.jsx)(v.W,{startContent:(0,r.jsx)(A.Z,{size:20}),onClick:()=>I(e.id),description:"Modify user details",children:"Modify"}),(0,r.jsx)(v.W,{startContent:(0,r.jsx)(P.Z,{size:20}),onClick:()=>O(e.id),description:"View user activity history",children:"Activity History"}),(0,r.jsx)(v.W,{startContent:(0,r.jsx)(_.Z,{size:20}),onClick:()=>z(e.id),description:"Send notification to user",children:"Send Notification"}),(0,r.jsx)(v.W,{startContent:(0,r.jsx)(C.Z,{size:20}),onClick:()=>b(e.id),description:"Temporarily disable account",children:"Block User"},"status"),(0,r.jsx)(v.W,{startContent:(0,r.jsx)(E.Z,{size:20}),className:"text-danger",color:"danger",onClick:()=>D(e.id),children:"Delete Account"})]})]})]})]})}),(0,r.jsx)(y.i,{children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsxs)("div",{className:"text-small text-default-500",children:["Role: ",e.role]}),e.tasker&&(0,r.jsx)("div",{className:"text-small text-default-500",children:"TASKER"})]})})]},e.id)})})},b=s(93361),z=s(46175),D=s(42321);let O={async create(e){try{let t=await D.Z.post("/users",e);return z.ZP.success("Tạo người d\xf9ng th\xe0nh c\xf4ng"),t.data}catch(e){throw z.ZP.error("Kh\xf4ng thể tạo người d\xf9ng"),e}},async getMe(){try{return(await D.Z.get("/users/me")).data}catch(e){throw z.ZP.error("Kh\xf4ng thể lấy th\xf4ng tin người d\xf9ng"),e}},async getAll(){try{return(await D.Z.get("/users")).data}catch(e){throw z.ZP.error("Kh\xf4ng thể lấy th\xf4ng tin người d\xf9ng"),e}},async deleteUser(e){try{let t=await D.Z.delete("/users/".concat(e));return z.ZP.success("X\xf3a người d\xf9ng th\xe0nh c\xf4ng"),t.data}catch(e){throw z.ZP.error("Kh\xf4ng thể x\xf3a người d\xf9ng"),e}}};var R=s(47043),M=s(61915),W=s(63861),L=()=>{let{data:e,isLoading:t,error:s,mutate:i}=(0,W.ZP)("/users",O.getAll);if(t)return(0,r.jsx)("div",{children:(0,r.jsx)(R.Z,{})});if(s)return(0,r.jsxs)("div",{children:["Error: ",s]});let n=async e=>{await i(),console.log("Deleted user:",e)};return(0,r.jsx)(M.ProtectedRoute,{children:(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h1",{className:"text-5xl font-extrabold text-emerald-800 text-center py-8",children:"User Accounts Management"}),(0,r.jsx)("div",{className:"mt-12 w-full mx-auto bg-white p-6 rounded-lg shadow-md space-y-2",children:(0,r.jsx)(b.o,{className:"h-[800px] w-full",children:(0,r.jsx)("div",{className:"space-y-4 p-4",children:(0,r.jsx)(I,{users:[...e||[]].reverse(),onView:e=>console.log("View user:",e),onModify:e=>console.log("Modify user:",e),onBlock:e=>console.log("Block user:",e),onHistory:e=>console.log("View history:",e),onDelete:n,onNotify:e=>console.log("Notify user:",e)})})})})]})})}},47043:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});var r=s(57437),i=s(1377);function n(){return(0,r.jsx)("div",{className:"fixed inset-0 bg-white flex items-center justify-center z-50",children:(0,r.jsx)(i.c,{size:"lg",color:"success",label:"Loading..."})})}},61915:function(e,t,s){"use strict";s.d(t,{ProtectedRoute:function(){return c}});var r=s(57437),i=s(50835),n=s(99376),a=s(2265),l=s(47043);function c(e){let{children:t}=e,{isAuthenticated:s,user:c}=(0,i.CG)(e=>e.auth),o=(0,n.useRouter)(),h=(0,n.usePathname)(),d=["/admin","/admin/users","/admin/tasks","/admin/monitor"],{isTasker:u}=(0,i.CG)(e=>e.auth);return((0,a.useEffect)(()=>{if(s){let e=window.location.pathname;!u&&["/tasks","/taskmanage"].includes(e)&&o.replace("/becometasker")}else o.replace("/login");if(d.some(e=>h.startsWith(e))&&(null==c?void 0:c.role)!=="ADMIN"){o.replace("/");return}if((null==c?void 0:c.role)==="ADMIN"&&"/"===h){o.replace("/admin");return}},[s,c,h,o]),!s||d.some(e=>h.startsWith(e))&&(null==c?void 0:c.role)!=="ADMIN")?(0,r.jsx)(l.Z,{}):t}},11002:function(e,t,s){"use strict";s.d(t,{Dj:function(){return i},UR:function(){return l},YA:function(){return c},kS:function(){return n},uJ:function(){return a}});let r=(0,s(1455).oM)({name:"auth",initialState:{user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isTasker:!1},reducers:{setCredentials:(e,t)=>{let{user:s,token:r}=t.payload;e.user=s,e.accessToken=r.access_token,e.refreshToken=r.refresh_token,e.isAuthenticated=!0,s.tasker&&(e.isTasker=!0),localStorage.setItem("user",JSON.stringify(s)),localStorage.setItem("isTasker",e.isTasker.toString()),localStorage.setItem("accessToken",r.access_token),localStorage.setItem("refreshToken",r.refresh_token)},setisTaskers:(e,t)=>{e.isTasker=t.payload,localStorage.setItem("isTasker","true")},logout:e=>{e.user=null,e.accessToken=null,e.refreshToken=null,e.isTasker=!1,e.isAuthenticated=!1,localStorage.removeItem("user"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("isTasker")},loginFailure:e=>{console.log("Login failed"),e.isAuthenticated=!1},initializeAuth:e=>{try{let t=localStorage.getItem("user"),s=localStorage.getItem("accessToken"),r=localStorage.getItem("refreshToken"),i=localStorage.getItem("isTasker");t&&s&&r?(e.user=JSON.parse(t),e.accessToken=s,e.refreshToken=r,e.isAuthenticated=!0):e.isAuthenticated=!1,(null==i?void 0:i.toString())==="true"&&(e.isTasker="true"===i)}catch(t){console.error("Error initializing auth from localStorage:",t),e.isAuthenticated=!1}}}}),{setCredentials:i,logout:n,initializeAuth:a,loginFailure:l,setisTaskers:c}=r.actions;t.ZP=r.reducer},50835:function(e,t,s){"use strict";s.d(t,{CG:function(){return c},TL:function(){return l},h:function(){return a}});var r=s(1455),i=s(68575),n=s(11002);let a=(0,r.xC)({reducer:{auth:n.ZP},middleware:e=>e({serializableCheck:!1})}),l=i.I0,c=i.v9},82479:function(e,t,s){"use strict";s.d(t,{O:function(){return o}});var r=s(11002),i=s(50835),n=s(83464),a=s(42321),l=s(46175);class c{async register(e){try{let t=await a.Z.post("/auth/register",JSON.stringify(e));return l.ZP.success("Đăng k\xfd th\xe0nh c\xf4ng"),t.data}catch(e){throw l.ZP.error("Đăng k\xfd thất bại"),console.log(e),e}}async login(e){try{console.log("http://localhost:5000/api/auth/login");let t=await a.Z.post("/auth/login",JSON.stringify(e)),s=t.data;return i.h.dispatch((0,r.Dj)(s)),l.ZP.success("Đăng nhập th\xe0nh c\xf4ng"),t.data}catch(t){throw console.log(t),l.ZP.error("Đăng nhập thất bại"),this.handleAuthError(e),t}}async refreshToken(){if(this.refreshPromise)return this.refreshPromise;let e=this.getRefreshToken();if(!e)throw Error("No refresh token available");return this.refreshPromise=a.Z.post("/auth/refresh",{refreshToken:e}).then(e=>{let{access_token:t,refresh_token:s}=e.data;return i.h.dispatch((0,r.Dj)({user:i.h.getState().auth.user,token:{access_token:t,refresh_token:s}})),e.data}).catch(e=>{throw this.logout(),e}).finally(()=>{this.refreshPromise=null}),this.refreshPromise}async logout(){i.h.dispatch((0,r.kS)())}handleAuthError(e){if(n.Z.isAxiosError(e)){var t,s;let n=(null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"Authentication failed";i.h.dispatch((0,r.UR)(n))}else i.h.dispatch((0,r.UR)())}getAccessToken(){return i.h.getState().auth.accessToken}getRefreshToken(){return i.h.getState().auth.refreshToken}isTokenExpired(e){if(!e)return!0;try{let t=e.split(".");if(3!==t.length)return!0;let s=JSON.parse(atob(t[1]));return Date.now()>=1e3*s.exp-3e4}catch(e){return!0}}constructor(){this.refreshPromise=null}}let o=new c},42321:function(e,t,s){"use strict";var r=s(83464),i=s(82479);let n=r.Z.create({baseURL:"http://localhost:5000/api",headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:1e4});n.interceptors.request.use(async e=>{var t,s,r;let n=i.O.getAccessToken();if((null===(t=e.url)||void 0===t?void 0:t.includes("/auth/login"))||(null===(s=e.url)||void 0===s?void 0:s.includes("/auth/refresh"))||(null===(r=e.url)||void 0===r?void 0:r.includes("/auth/register")))return console.log(e),e;try{if(!n)throw Error("No access token available");if(i.O.isTokenExpired(n)){let t=await i.O.refreshToken();e.headers.Authorization="Bearer ".concat(t.access_token)}else e.headers.Authorization="Bearer ".concat(n)}catch(e){i.O.logout(),console.log(e)}return e},e=>Promise.reject(e)),n.interceptors.response.use(e=>e,async e=>{var t;let s=e.config;if(!s||s._retry)return Promise.reject(e);if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&s.url&&!s.url.includes("/auth/login")&&!s.url.includes("/auth/refresh"))try{s._retry=!0;let e=await i.O.refreshToken();return s.headers&&(s.headers.Authorization="Bearer ".concat(e.access_token)),n(s)}catch(e){return i.O.logout(),Promise.reject(e)}return Promise.reject(e)}),t.Z=n},16454:function(e,t,s){"use strict";s.d(t,{E:function(){return a}});var r=s(46175);let i=[],n=async()=>{try{let e=await fetch("https://provinces.open-api.vn/api/p/01?depth=2");i=(await e.json()).districts}catch(e){throw r.ZP.error("Lỗi khi tải dữ liệu quận huyện"),e}},a={async getDistrict(e){try{if(0===i.length&&await n(),!e)return"No area specified";return e.split(",").map(e=>e.trim()).map(e=>parseInt(e)).map(e=>{var t;return(null===(t=i.find(t=>parseInt(t.code)===e))||void 0===t?void 0:t.name)||e.toString()}).join(", ")}catch(e){throw r.ZP.error("Lỗi khi lấy dữ liệu quận huyện"),e}},async getWard(e){try{return(await fetch("https://provinces.open-api.vn/api/w/".concat(e,"?depth=1"))).json()}catch(e){throw r.ZP.error("Lỗi khi tải dữ liệu quận huyện"),e}}}}},function(e){e.O(0,[707,7405,4218,8187,2952,1554,8083,6175,3464,9863,4721,4958,9136,9062,3343,1708,8553,2971,2117,1744],function(){return e(e.s=53355)}),_N_E=e.O()}]);