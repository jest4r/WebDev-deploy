(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9889],{19590:function(e,t,s){Promise.resolve().then(s.bind(s,67338))},67338:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return S}});var r=s(57437),a=s(2265),n=s(16454),i=s(75265),c=s(4922),l=s(99008),o=s(62127),h=s(99394),u=s(33374),d=s(97717),g=s(29721),m=s(35069),x=s(88139),f=s(83774),p=s(91723),k=s(41639),y=s(27413),v=s(21949),j=s(99376),w=e=>{let{tasks:t,onView:s,onDelete:w}=e,N=(0,j.useRouter)(),{isOpen:T,onOpen:Z,onClose:P}=(0,i.q)(),[S,A]=(0,a.useState)("");(0,a.useEffect)(()=>{let e=async e=>{try{if(e.district){let t=await n.E.getDistrict(e.district);A(t)}}catch(e){console.error("Error fetching district names:",e),A("Error loading districts")}};t.forEach(t=>e(t))},[t]);let _=async e=>{try{await v.O.deleteMe(e),w(e),N.refresh()}catch(e){console.error(e)}},I=e=>{switch(e.toLowerCase()){case"posted":default:return"default";case"pending":return"warning";case"in_progress":return"primary";case"completed":return"success";case"cancelled":return"danger"}};return(0,r.jsx)(r.Fragment,{children:t.map(e=>{var t,a;return(0,r.jsx)(c.w,{className:"w-full",children:(0,r.jsx)(l.G,{children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:e.title}),(0,r.jsx)(o.z,{color:I(e.task_status),size:"sm",children:e.task_status})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-500",children:[(0,r.jsx)(f.Z,{size:16}),(0,r.jsx)("span",{children:S})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-gray-500",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(p.Z,{size:16}),(0,r.jsxs)("span",{children:[" ",new Date(e.start_date).toLocaleDateString()]})]}),(0,r.jsxs)("div",{children:["Duration: ",e.estimated_duration," h "]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-500",children:[(0,r.jsx)(k.Z,{size:16}),(0,r.jsxs)("span",{children:[" Skill: ",(null===(t=e.skill)||void 0===t?void 0:t.name)||"No Skill"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(h.A,{onPress:Z,variant:"light",onClick:()=>s(e.id),className:"flex",children:"View Details"}),(0,r.jsx)(u.R,{isOpen:T,onClose:P,size:"2xl",children:(0,r.jsxs)(d.A,{children:[(0,r.jsx)(g.k,{className:"flex flex-col gap-1",children:"Task Details"}),(0,r.jsx)(m.I,{children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm text-gray-500",children:"Task Title"}),(0,r.jsx)("p",{className:"text-lg font-semibold",children:e.title})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm text-gray-500",children:"Status"}),(0,r.jsx)(o.z,{color:I(e.task_status),size:"sm",children:e.task_status})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm text-gray-500",children:"Area"}),(0,r.jsxs)("p",{className:"flex items-center gap-2",children:[(0,r.jsx)(f.Z,{size:16}),S||e.district]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm text-gray-500",children:"Skill"}),(0,r.jsxs)("p",{className:"flex items-center gap-2",children:[(0,r.jsx)(k.Z,{size:16}),(null===(a=e.skill)||void 0===a?void 0:a.name)||"No skill"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm text-gray-500",children:"Time"}),(0,r.jsxs)("p",{className:"flex items-center gap-2",children:[(0,r.jsx)(p.Z,{size:16}),e.start_date]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm text-gray-500",children:"Duration"}),(0,r.jsxs)("p",{children:[e.estimated_duration," h"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm text-gray-500",children:"Price"}),(0,r.jsxs)("p",{children:[e.fee_per_hour," VNĐ"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm text-gray-500",children:"Description"}),(0,r.jsx)("p",{className:"text-gray-700",children:e.description})]})]})}),(0,r.jsx)(x.R,{children:(0,r.jsx)(h.A,{color:"primary",variant:"solid",onPress:P,children:"I got it"})})]})}),(0,r.jsx)(h.A,{startContent:(0,r.jsx)(y.Z,{size:20}),className:"text-white",color:"danger",onClick:()=>_(e),children:"Delete"})]})]})})},e.id)})})},N=s(93361),T=s(47043),Z=s(61915),P=s(63861);function S(){let{data:e,isLoading:t,error:s,mutate:a}=(0,P.ZP)("/tasks/admin",v.O.getMe),n=async e=>{await a(),console.log("Deleted skill:",e)};return t?(0,r.jsx)(T.Z,{}):s?(0,r.jsxs)("div",{children:["Error: ",s]}):(0,r.jsx)(Z.ProtectedRoute,{children:(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h1",{className:"text-5xl font-extrabold text-emerald-800 text-center py-8",children:"Task Data Management"}),(0,r.jsx)("div",{className:"mt-12 w-full mx-auto bg-white p-6 rounded-lg shadow-md space-y-2",children:(0,r.jsx)(N.o,{className:"h-[800px] w-full",children:(0,r.jsx)("div",{className:"space-y-4 p-4",children:(0,r.jsx)(w,{tasks:[...e||[]].reverse(),onView:e=>console.log("View user:",e),onDelete:n})})})})]})})}},47043:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});var r=s(57437),a=s(1377);function n(){return(0,r.jsx)("div",{className:"fixed inset-0 bg-white flex items-center justify-center z-50",children:(0,r.jsx)(a.c,{size:"lg",color:"success",label:"Loading..."})})}},61915:function(e,t,s){"use strict";s.d(t,{ProtectedRoute:function(){return l}});var r=s(57437),a=s(50835),n=s(99376),i=s(2265),c=s(47043);function l(e){let{children:t}=e,{isAuthenticated:s,user:l}=(0,a.CG)(e=>e.auth),o=(0,n.useRouter)(),h=(0,n.usePathname)(),u=["/admin","/admin/users","/admin/tasks","/admin/monitor"],{isTasker:d}=(0,a.CG)(e=>e.auth);return((0,i.useEffect)(()=>{if(s){let e=window.location.pathname;!d&&["/tasks","/taskmanage"].includes(e)&&o.replace("/becometasker")}else o.replace("/login");if(u.some(e=>h.startsWith(e))&&(null==l?void 0:l.role)!=="ADMIN"){o.replace("/");return}if((null==l?void 0:l.role)==="ADMIN"&&"/"===h){o.replace("/admin");return}},[s,l,h,o]),!s||u.some(e=>h.startsWith(e))&&(null==l?void 0:l.role)!=="ADMIN")?(0,r.jsx)(c.Z,{}):t}},11002:function(e,t,s){"use strict";s.d(t,{Dj:function(){return a},UR:function(){return c},YA:function(){return l},kS:function(){return n},uJ:function(){return i}});let r=(0,s(1455).oM)({name:"auth",initialState:{user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isTasker:!1},reducers:{setCredentials:(e,t)=>{let{user:s,token:r}=t.payload;e.user=s,e.accessToken=r.access_token,e.refreshToken=r.refresh_token,e.isAuthenticated=!0,s.tasker&&(e.isTasker=!0),localStorage.setItem("user",JSON.stringify(s)),localStorage.setItem("isTasker",e.isTasker.toString()),localStorage.setItem("accessToken",r.access_token),localStorage.setItem("refreshToken",r.refresh_token)},setisTaskers:(e,t)=>{e.isTasker=t.payload,localStorage.setItem("isTasker","true")},logout:e=>{e.user=null,e.accessToken=null,e.refreshToken=null,e.isTasker=!1,e.isAuthenticated=!1,localStorage.removeItem("user"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("isTasker")},loginFailure:e=>{console.log("Login failed"),e.isAuthenticated=!1},initializeAuth:e=>{try{let t=localStorage.getItem("user"),s=localStorage.getItem("accessToken"),r=localStorage.getItem("refreshToken"),a=localStorage.getItem("isTasker");t&&s&&r?(e.user=JSON.parse(t),e.accessToken=s,e.refreshToken=r,e.isAuthenticated=!0):e.isAuthenticated=!1,(null==a?void 0:a.toString())==="true"&&(e.isTasker="true"===a)}catch(t){console.error("Error initializing auth from localStorage:",t),e.isAuthenticated=!1}}}}),{setCredentials:a,logout:n,initializeAuth:i,loginFailure:c,setisTaskers:l}=r.actions;t.ZP=r.reducer},50835:function(e,t,s){"use strict";s.d(t,{CG:function(){return l},TL:function(){return c},h:function(){return i}});var r=s(1455),a=s(68575),n=s(11002);let i=(0,r.xC)({reducer:{auth:n.ZP},middleware:e=>e({serializableCheck:!1})}),c=a.I0,l=a.v9},82479:function(e,t,s){"use strict";s.d(t,{O:function(){return o}});var r=s(11002),a=s(50835),n=s(83464),i=s(42321),c=s(46175);class l{async register(e){try{let t=await i.Z.post("/auth/register",JSON.stringify(e));return c.ZP.success("Đăng k\xfd th\xe0nh c\xf4ng"),t.data}catch(e){throw c.ZP.error("Đăng k\xfd thất bại"),console.log(e),e}}async login(e){try{console.log("http://localhost:5000/api/auth/login");let t=await i.Z.post("/auth/login",JSON.stringify(e)),s=t.data;return a.h.dispatch((0,r.Dj)(s)),c.ZP.success("Đăng nhập th\xe0nh c\xf4ng"),t.data}catch(t){throw console.log(t),c.ZP.error("Đăng nhập thất bại"),this.handleAuthError(e),t}}async refreshToken(){if(this.refreshPromise)return this.refreshPromise;let e=this.getRefreshToken();if(!e)throw Error("No refresh token available");return this.refreshPromise=i.Z.post("/auth/refresh",{refreshToken:e}).then(e=>{let{access_token:t,refresh_token:s}=e.data;return a.h.dispatch((0,r.Dj)({user:a.h.getState().auth.user,token:{access_token:t,refresh_token:s}})),e.data}).catch(e=>{throw this.logout(),e}).finally(()=>{this.refreshPromise=null}),this.refreshPromise}async logout(){a.h.dispatch((0,r.kS)())}handleAuthError(e){if(n.Z.isAxiosError(e)){var t,s;let n=(null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"Authentication failed";a.h.dispatch((0,r.UR)(n))}else a.h.dispatch((0,r.UR)())}getAccessToken(){return a.h.getState().auth.accessToken}getRefreshToken(){return a.h.getState().auth.refreshToken}isTokenExpired(e){if(!e)return!0;try{let t=e.split(".");if(3!==t.length)return!0;let s=JSON.parse(atob(t[1]));return Date.now()>=1e3*s.exp-3e4}catch(e){return!0}}constructor(){this.refreshPromise=null}}let o=new l},42321:function(e,t,s){"use strict";var r=s(83464),a=s(82479);let n=r.Z.create({baseURL:"http://localhost:5000/api",headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:1e4});n.interceptors.request.use(async e=>{var t,s,r;let n=a.O.getAccessToken();if((null===(t=e.url)||void 0===t?void 0:t.includes("/auth/login"))||(null===(s=e.url)||void 0===s?void 0:s.includes("/auth/refresh"))||(null===(r=e.url)||void 0===r?void 0:r.includes("/auth/register")))return console.log(e),e;try{if(!n)throw Error("No access token available");if(a.O.isTokenExpired(n)){let t=await a.O.refreshToken();e.headers.Authorization="Bearer ".concat(t.access_token)}else e.headers.Authorization="Bearer ".concat(n)}catch(e){a.O.logout(),console.log(e)}return e},e=>Promise.reject(e)),n.interceptors.response.use(e=>e,async e=>{var t;let s=e.config;if(!s||s._retry)return Promise.reject(e);if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&s.url&&!s.url.includes("/auth/login")&&!s.url.includes("/auth/refresh"))try{s._retry=!0;let e=await a.O.refreshToken();return s.headers&&(s.headers.Authorization="Bearer ".concat(e.access_token)),n(s)}catch(e){return a.O.logout(),Promise.reject(e)}return Promise.reject(e)}),t.Z=n},16454:function(e,t,s){"use strict";s.d(t,{E:function(){return i}});var r=s(46175);let a=[],n=async()=>{try{let e=await fetch("https://provinces.open-api.vn/api/p/01?depth=2");a=(await e.json()).districts}catch(e){throw r.ZP.error("Lỗi khi tải dữ liệu quận huyện"),e}},i={async getDistrict(e){try{if(0===a.length&&await n(),!e)return"No area specified";return e.split(",").map(e=>e.trim()).map(e=>parseInt(e)).map(e=>{var t;return(null===(t=a.find(t=>parseInt(t.code)===e))||void 0===t?void 0:t.name)||e.toString()}).join(", ")}catch(e){throw r.ZP.error("Lỗi khi lấy dữ liệu quận huyện"),e}},async getWard(e){try{return(await fetch("https://provinces.open-api.vn/api/w/".concat(e,"?depth=1"))).json()}catch(e){throw r.ZP.error("Lỗi khi tải dữ liệu quận huyện"),e}}}},21949:function(e,t,s){"use strict";s.d(t,{O:function(){return n}});var r=s(46175),a=s(42321);let n={async create(e){try{let t=await a.Z.post("/tasks",e);return r.ZP.success("Tạo c\xf4ng việc th\xe0nh c\xf4ng"),t.data}catch(e){throw r.ZP.error("Kh\xf4ng thể tạo c\xf4ng việc n\xe0y"),e}},async getMe(){try{return(await a.Z.get("/tasks/admin")).data}catch(e){throw r.ZP.error("Kh\xf4ng thể lấy th\xf4ng tin c\xf4ng việc"),e}},async deleteMe(e){try{let t=await a.Z.delete("/tasks/".concat(e.id));return r.ZP.success("Hủy c\xf4ng việc th\xe0nh c\xf4ng"),t.data}catch(e){throw r.ZP.error("Kh\xf4ng thể hủy c\xf4ng việc n\xe0y"),e}},async getAllTasksCreatedByUser(){try{return(await a.Z.get("/tasks/user")).data}catch(e){throw r.ZP.error("Kh\xf4ng thể lấy th\xf4ng tin c\xf4ng việc"),e}},async userChooseTasker(e,t){try{await a.Z.patch("/tasks/".concat(e,"/choose/").concat(t)),r.ZP.success("Chọn Người l\xe0m việc th\xe0nh c\xf4ng")}catch(e){throw r.ZP.error("Kh\xf4ng thể chọn người l\xe0m n\xe0y! H\xe3y thử lại sau"),e}},async applyTask(e){try{let t=await a.Z.patch("/tasks/".concat(e,"/apply"));return r.ZP.success("Ứng tuyển c\xf4ng việc th\xe0nh c\xf4ng!"),console.log(t.data),t.data}catch(e){throw r.ZP.error("Kh\xf4ng thể ứng tuyển c\xf4ng việc n\xe0y"),e}},async acceptTask(e){try{let t=await a.Z.patch("/tasks/".concat(e,"/accept"));return r.ZP.success("Ứng tuyển c\xf4ng việc th\xe0nh c\xf4ng!"),console.log(t.data),t.data}catch(e){throw r.ZP.error("Kh\xf4ng thể ứng tuyển c\xf4ng việc n\xe0y"),e}},async getTaskerTasks(){try{let e=await a.Z.get("/tasks/tasker");return console.log(e.data),e.data}catch(e){throw r.ZP.error("Kh\xf4ng thể lấy th\xf4ng tin c\xf4ng việc"),e}}}}},function(e){e.O(0,[707,7405,4218,8187,2952,8083,6175,3464,9136,3343,326,2971,2117,1744],function(){return e(e.s=19590)}),_N_E=e.O()}]);